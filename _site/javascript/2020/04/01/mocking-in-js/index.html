<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Mocking In JS</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="James Lieu">
        <link rel="canonical"
        href="http://localhost:4000/javascript/2020/04/01/mocking-in-js/">

        <!-- Harmony styles -->
        <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

        <!-- Modernizr js -->
        <script async src="/assets/js/modernizr.js"></script>

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h2><a href="/">James Lieu</a></h2>
                <ul>
	<li>
		<a href="http://localhost:4000/">Home</a>
	</li>
	<li>
		<a href="http://localhost:4000/about">About</a>
		<span>/</span>
	</li>
	<li>
		<a href="http://localhost:4000/blog">Blog</a><span>/</span>
	</li>
	
	<li>
		<a title="jameslieu on Github"
			href="https://github.com/jameslieu" target="_blank">
			Github
		</a><span>/</span>
	</li>
	
	<li>
	</li>
</ul>
            </div>
        </header>
        <div class="page-content wc-container">
	<div class="post">
		<h3>Mocking In JS</h3>
		<p class="post-meta">
			
      <span class="categories">
      JavaScript
      </span> |
	    
	    <span class="post-date">
    	Apr 1, 2020
	    </span>
		</p>
		<div class="post">
			<p>Proxyquire VS SinonJS</p>

<!--more-->

<p>The purpose of this post is to compare the libraries we’re currently using for mocking in our tests.
The two primary libraries we’re using are <code class="language-plaintext highlighter-rouge">Proxyquire</code> and <code class="language-plaintext highlighter-rouge">Sinon</code>. </p>

<p>At the moment we’re using those interchangeably, and there seems to be some confusion to which one we should use or sometimes even both are used in the same test. The initial motivation for writing this blog was because of some of the challenges or confusion that we have faced when attempting to mock/stub the AWS SDK in our unit tests. So I have put together these notes to compare the ways we can achieve the same test for each library.</p>

<hr />
<h6 id="proxyquire"><a href="https://github.com/thlorenz/proxyquire">Proxyquire</a></h6>

<ul>
  <li>Takes over require and lets you inject fakes anywhere in the dependency chain.</li>
  <li>Thus it still loads the original, just replaces things with what you define.</li>
</ul>

<h6 id="sinonjs"><a href="https://github.com/sinonjs/sinon">SinonJS</a></h6>

<ul>
  <li>Doesn’t take over require</li>
  <li>It’s a more traditional mocking framework. Replace specified methods with fakes, or create a mock that tracks when it was called.</li>
</ul>

<hr />

<h5 id="examples">Examples</h5>

<p>Here is some example code I can use to demonstrate both Proxyquire and Sinon to see the difference.</p>

<p>Consider the following implementation:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">aws</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">aws-sdk</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">exampleFunction</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sqs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">SQS</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">receiveParams</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">QueueUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://example.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">MaxNumberOfMessages</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="na">WaitTimeSeconds</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">sqs</span><span class="p">.</span><span class="nx">receiveMessage</span><span class="p">(</span><span class="nx">receiveParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">msg</span> <span class="o">=&gt;</span> <span class="nx">sqs</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">msg</span><span class="p">).</span><span class="nx">promise</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is a basic example of using the aws-sdk library. We have an exampleFunction which calls SQS’s receiveMessage which then calls the sendMessage if the call was successful. If the sendMessage call is successful we assign the response to the result variable which is then returned.</p>

<p>Below we’ll show an example of how we might write a unit test (for success) for this with each library so we can compare the two:</p>

<h6 id="proxyrequire-example"><a href="https://github.com/thlorenz/proxyquire">Proxyrequire</a> Example</h6>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">proxyquire</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">proxyquire</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ava</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">serial</span><span class="p">(</span><span class="dl">'</span><span class="s1">test exampleFunction returns bar</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">SQS</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="na">receiveMessage</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="p">{</span> <span class="na">promise</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span> <span class="p">}</span> <span class="p">}</span>
                <span class="p">},</span>
                <span class="na">sendMessage</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="na">promise</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">let</span> <span class="nx">awsSdkSqsExample</span> <span class="o">=</span> <span class="nx">proxyquire</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/aws-sdk-sqs-example</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="dl">'</span><span class="s1">aws-sdk</span><span class="dl">'</span><span class="p">:</span> <span class="nx">AWS</span>
    <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">actual</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">awsSdkSqsExample</span><span class="p">.</span><span class="nx">exampleFunction</span><span class="p">();</span>
    <span class="kd">let</span> <span class="nx">expected</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">;</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">);</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>With Proxyquire, we can take over the require statement to import the exampleFunction but also creating fake data to replace the actual aws-sdk functions in order to assert the values we want. Proxyquire will only replace the functions which we define while still allowing the other available functions to work and be used as normal. Which means Proxyquire can work very well as a feature test.</p>

<p>One thing I also noticed (particularly with this example) was that there interesting behavior in regards to validation. The receiveMessage function has validation. If the receiveParams passed in were to be invalid, then the Promise will be rejected. This can be considered a positive or negative outcome as it encourages the tests to be written with valid parameters but at the same time its not a true mock/stub and was a little unexpected.</p>

<p>One thing you can’t do is assert the stub. we can only assert the values based off what we’ve stubbed and returned</p>

<h6 id="sinon-example"><a href="https://github.com/sinonjs/sinon">Sinon</a> Example</h6>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">awsSdkSqsExample</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/aws-sdk-sqs-example</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">aws-sdk</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sinon</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">sinon</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ava</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">sinon</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">serial</span><span class="p">(</span><span class="dl">'</span><span class="s1">test exampleFunction returns bar</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sqsStub</span> <span class="o">=</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">(</span><span class="nx">AWS</span><span class="p">,</span> <span class="dl">'</span><span class="s1">SQS</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">receiveMessageSpy</span> <span class="o">=</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">spy</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="na">promise</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span> <span class="p">}</span>
        <span class="p">};</span>
    <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">sendMessageSpy</span> <span class="o">=</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">spy</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="na">promise</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">sqsStub</span><span class="p">.</span><span class="nx">returns</span><span class="p">({</span>
        <span class="na">receiveMessage</span><span class="p">:</span> <span class="nx">receiveMessageSpy</span><span class="p">,</span>
        <span class="na">sendMessage</span><span class="p">:</span> <span class="nx">sendMessageSpy</span>
    <span class="p">});</span>

    <span class="kd">let</span> <span class="nx">actual</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">awsSdkSqsExample</span><span class="p">.</span><span class="nx">exampleFunction</span><span class="p">();</span>
    <span class="kd">let</span> <span class="nx">expected</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">;</span>

    <span class="nx">sinon</span><span class="p">.</span><span class="nx">assert</span><span class="p">.</span><span class="nx">calledOnce</span><span class="p">(</span><span class="nx">receiveMessageSpy</span><span class="p">);</span>
    <span class="nx">sinon</span><span class="p">.</span><span class="nx">assert</span><span class="p">.</span><span class="nx">calledOnce</span><span class="p">(</span><span class="nx">sendMessageSpy</span><span class="p">);</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">);</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Sinon is considered a ‘true’ mock/stub/spy framework. It is also familiar in its use case.</p>

<p>The external libraries/classes/functions are completely mocked and thus allowing more flexibility, particularly with asserting them (including the number of times a mock as called). Not only can we determine what is returned from a function, we can configure the different return values depending on how many times a function is called i.e. a difference value if the function was called a second time.</p>

<h6 id="proxyquire-with-sinon-example">Proxyquire with Sinon Example</h6>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">proxyquire</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">proxyquire</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sinon</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">sinon</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ava</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">sinon</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">serial</span><span class="p">(</span><span class="dl">'</span><span class="s1">test exampleFunction using both proxyquire and sinon</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">sqsStubs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">receiveMessage</span><span class="p">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">().</span><span class="nx">returns</span><span class="p">({</span> <span class="na">promise</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span> <span class="p">}),</span>
        <span class="na">sendMessage</span><span class="p">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">().</span><span class="nx">returns</span><span class="p">({</span> <span class="na">promise</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">)</span> <span class="p">}),</span>
    <span class="p">};</span>

    <span class="kd">let</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">config</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">update</span><span class="p">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="na">SQS</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">sqsStubs</span> <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">let</span> <span class="nx">awsSdkSqsExample</span> <span class="o">=</span> <span class="nx">proxyquire</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/aws-sdk-sqs-example</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="dl">'</span><span class="s1">aws-sdk</span><span class="dl">'</span><span class="p">:</span> <span class="nx">AWS</span>
    <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">actual</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">awsSdkSqsExample</span><span class="p">.</span><span class="nx">exampleFunction</span><span class="p">();</span>
    <span class="kd">let</span> <span class="nx">expected</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">;</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">);</span>
    <span class="nx">sinon</span><span class="p">.</span><span class="nx">assert</span><span class="p">.</span><span class="nx">calledOnce</span><span class="p">(</span><span class="nx">sqsStubs</span><span class="p">.</span><span class="nx">receiveMessage</span><span class="p">);</span>
    <span class="nx">sinon</span><span class="p">.</span><span class="nx">assert</span><span class="p">.</span><span class="nx">calledOnce</span><span class="p">(</span><span class="nx">sqsStubs</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">);</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>It is possible to use both at the same time. Although its worth considering what value this might bring if the test can be achieved with just one of them.</p>

<h6 id="aws-sdk-mock-example"><a href="https://github.com/dwyl/aws-sdk-mock">aws-sdk-mock</a> Example</h6>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">awsSdkSqsExample</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/aws-sdk-sqs-example</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">aws-sdk-mock</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ava</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">AWS</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">serial</span><span class="p">(</span><span class="dl">'</span><span class="s1">test exampleFunction returns bar</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">receieveMessageResponse</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">QueueUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://example.com/test</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">MessageBody</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test 123</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="nx">AWS</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">SQS</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">receiveMessage</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">receieveMessageResponse</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">AWS</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">SQS</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">sendMessage</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="kd">let</span> <span class="nx">actual</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">awsSdkSqsExample</span><span class="p">.</span><span class="nx">exampleFunction</span><span class="p">();</span>
    <span class="kd">let</span> <span class="nx">expected</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">;</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">);</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Its worth also mentioning that specifically for mocking the aws-sdk there is another library we can use, aws-sdk-mock. This library is really designed for syntactic sugar and actually uses Sinon to do its mocking. It does look cleaner and more readable. So this can also be an option to consider as well. There does seem to be a limitation for asserting whether the mock was called but I believe there is an option to use a “Sinon Spy” with this library which then allows for adding those assertions.</p>

<h4 id="summary">Summary</h4>

<p>Any of the above libraries are fit for our use cases. And there’s nothing particularly wrong with using all three. And the examples that were provided are very basic and may not even be the best way of writing those tests, there are more functionality and utility that I can see in the official documentation so its worth having a look at those as well (links are at the bottom).</p>

<p>Its worth thinking about considering some consistency in how we use these libraries, to avoid confusion as well as improve maintainability of our own tests.</p>

<p>For some, Proxyquire feels more intuitive than Sinon. Once the ‘stubs’ are defined, its can become clearer to read what will happen once those are called. The advantage of defining exactly which functions needs stubbing allows for the some degree of ‘feature testing’ which can be useful.</p>

<p>If we’re unit testing, we need to decide how ‘isolated’ is our test going to be, if we’re intending to test in full isolation then Sinon would be a better fit. Not only does it fully mock/stub the external libraries/functions (including assertions), but we’re also familiar with its ‘style’ as it is similar to other mocking frameworks we’re used to and currently using in other projects.</p>

<hr />

<h4 id="external-resources">External Resources</h4>

<p><a href="https://github.com/thlorenz/proxyquire">https://github.com/thlorenz/proxyquire</a></p>

<p><a href="https://github.com/sinonjs/sinon">https://github.com/sinonjs/sinon</a></p>

<p><a href="https://github.com/dwyl/aws-sdk-mock">https://github.com/dwyl/aws-sdk-mock</a></p>

		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h2>
		<ul class="posts">
		    
		    <li>
			  <span>04 May 2020 &raquo;</span>
			  <a href="http://localhost:4000/php/2020/05/04/is-php-bad/">Is PHP Bad?</a>
		    </li>
		    
		    <li>
			  <span>28 Apr 2020 &raquo;</span>
			  <a href="http://localhost:4000/git/2020/04/28/git-workflow/">Git Workflow</a>
		    </li>
		    
		    <li>
			  <span>24 Apr 2020 &raquo;</span>
			  <a href="http://localhost:4000/salary/2020/04/24/provide-expected-salary/">Should I Provide An Expected Salary?</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="http://localhost:4000/javascript/2020/03/31/the-spa-argument/"><< Older</a>
			
		</div>
		<div class="column-2"><a href="http://localhost:4000/ ">Home</a></div>
		<div class="column-3">
			
				<a href="http://localhost:4000/aws/sqs/sns/2020/04/01/introduction-to-sqs-and-sns/">Newer >></a>
			
		</div>
	</div>
</div>

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu footer">
    <li><a href="http://localhost:4000/about">About</a></li>
    <li><a href="http://localhost:4000/blog">Blog</a></li>
</ul>		
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="J_Lieu on Twitter" 
            href="https://twitter.com/J_Lieu" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="jameslieu on Github" 
            href="https://github.com/jameslieu" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    

    

    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
<!-- Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a> -->
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'https://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="/assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </body>
</html>
